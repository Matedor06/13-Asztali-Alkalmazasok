<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="Solution.DesktopApp.Views.CarListView"
             xmlns:viewModels="clr-namespace:Solution.DesktopApp.ViewModels"
             xmlns:components="clr-namespace:Solution.DesktopApp.Components"
             xmlns:models="clr-namespace:Solution.Core.Models;assembly=Solution.Core"
             x:DataType="viewModels:CarListViewModel"
             x:Name="this"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#1E1E1E}">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior Command="{Binding AppearingCommand}"
                                        EventName="Appearing"
                                        BindingContext="{Binding Source={x:Reference this}, Path=BindingContext}"/>

        <toolkit:EventToCommandBehavior Command="{Binding DisappearingCommand}"
                                        EventName="Disappearing" 
                                        BindingContext="{Binding Source={x:Reference this}, Path=BindingContext}"/>
    </ContentPage.Behaviors>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="120" />
            <RowDefinition Height="*" />
            <RowDefinition Height="80" />
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" 
                BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1976D2}"
                Margin="20,20,20,10">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="15" />
            </Border.StrokeShape>
            <Grid>
                <Label Text="🚗 CAR COLLECTION"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />
                <Label Text="{Binding Cars.Count, StringFormat='Total: {0} cars'}"
                       FontSize="14"
                       TextColor="White"
                       Opacity="0.8"
                       HorizontalOptions="End"
                       VerticalOptions="End"
                       Margin="0,0,20,15" />
            </Grid>
        </Border>

        <!-- Cars Collection -->
        <ScrollView Grid.Row="1" Margin="20,0">
            <CollectionView ItemsSource="{Binding Cars}"
                          ItemSpacing="15">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" 
                                   Span="1"
                                   VerticalItemSpacing="15"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:CarModel">
                        <components:CarListComponent Car="{Binding .}"
                                                   DeleteCommand="{Binding Source={RelativeSource AncestorType={x:Type viewModels:CarListViewModel}}, Path=DeleteCommand}"
                                                   CommandParameter="{Binding Id}"/>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <StackLayout VerticalOptions="Center" HorizontalOptions="Center" Margin="20">
                        <Label Text="🚗" FontSize="60" HorizontalOptions="Center" />
                        <Label Text="No cars available"
                               FontSize="18"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                        <Label Text="Add some cars to get started!"
                               FontSize="14"
                               HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#999, Dark=#777}"
                               Margin="0,5,0,0" />
                    </StackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </ScrollView>

        <!-- Pagination Section -->
        <Border Grid.Row="2" 
                BackgroundColor="{AppThemeBinding Light=White, Dark=#2D2D2D}"
                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                StrokeThickness="1"
                Margin="20,10,20,20">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="10" />
            </Border.StrokeShape>
            <Grid Padding="20,15">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Text="◀ Previous"
                        Command="{Binding PreviousPageCommand}"
                        BackgroundColor="{AppThemeBinding Light=#FF9800, Dark=#F57C00}"
                        TextColor="White"
                        FontAttributes="Bold"
                        CornerRadius="20"
                        HorizontalOptions="Start"
                        WidthRequest="120" />

                <Label Grid.Column="1"
                       Text="Page Navigation"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#333, Dark=#CCC}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />

                <Button Grid.Column="2"
                        Text="Next ▶"
                        Command="{Binding NextPageCommand}"
                        BackgroundColor="{AppThemeBinding Light=#4CAF50, Dark=#388E3C}"
                        TextColor="White"
                        FontAttributes="Bold"
                        CornerRadius="20"
                        HorizontalOptions="End"
                        WidthRequest="120" />
            </Grid>
        </Border>
    </Grid>
</ContentPage>