<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="Solution.DesktopApp.Views.CarListView"
             xmlns:viewModels="clr-namespace:Solution.DesktopApp.ViewModels"
             xmlns:components="clr-namespace:Solution.DesktopApp.Components"
             xmlns:models="clr-namespace:Solution.Core.Models;assembly=Solution.Core"
             x:DataType="viewModels:CarListViewModel"
             x:Name="this"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#1E1E1E}">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior Command="{Binding AppearingCommand}"
                                        EventName="Appearing"
                                        BindingContext="{Binding Source={x:Reference this}, Path=BindingContext}"/>

        <toolkit:EventToCommandBehavior Command="{Binding DisappearingCommand}"
                                        EventName="Disappearing" 
                                        BindingContext="{Binding Source={x:Reference this}, Path=BindingContext}"/>
    </ContentPage.Behaviors>

    <Grid Padding="20" RowSpacing="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Page Title -->
        <Label Grid.Row="0"
               Text="CAR COLLECTION"
               Style="{StaticResource PageTitle}"
               HorizontalOptions="Center"
               Margin="0,10,0,20" />

        <!-- Table Header -->
        <Border Grid.Row="1"
                BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1976D2}"
                Stroke="{AppThemeBinding Light=#1976D2, Dark=#0D47A1}"
                StrokeThickness="1">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="120" />
                    <ColumnDefinition Width="120" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="80" />
                    <ColumnDefinition Width="80" />
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0" Text="Manufacturer" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="1" Text="Type" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="2" Text="Model" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Start" 
                       VerticalTextAlignment="Center" 
                       Margin="10,0,0,0" />
                <Label Grid.Column="3" Text="Cubic (cc)" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="4" Text="Year" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="5" Text="Doors" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="6" Text="Image" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="7" Text="Edit" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="8" Text="Delete" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
            </Grid>
        </Border>

        <!-- Cars Collection -->
        <Border Grid.Row="2"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#2D2D2D}"
                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                StrokeThickness="1">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8" />
            </Border.StrokeShape>
            
            <ScrollView>
                <CollectionView ItemsSource="{Binding Cars}">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:CarModel">
                            <Border BackgroundColor="Transparent"
                                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                                    Padding="0">
                                <components:CarListComponent Car="{Binding .}"
                                                           DeleteCommand="{Binding Source={RelativeSource AncestorType={x:Type viewModels:CarListViewModel}}, Path=DeleteCommand}"
                                                           CommandParameter="{Binding Id}"/>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.EmptyView>
                        <StackLayout VerticalOptions="Center" 
                                   HorizontalOptions="Center" 
                                   Padding="40">
                            <Label Text="No cars available"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            <Label Text="Add some cars to get started!"
                                   FontSize="14"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   TextColor="{AppThemeBinding Light=#999, Dark=#777}"
                                   Margin="0,10,0,0" />
                        </StackLayout>
                    </CollectionView.EmptyView>
                </CollectionView>
            </ScrollView>
        </Border>

        <!-- Pagination Section -->
        <Border Grid.Row="3"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#2D2D2D}"
                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                StrokeThickness="1"
                Padding="20">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8" />
            </Border.StrokeShape>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Text="◀ Previous"
                        Command="{Binding PreviousPageCommand}"
                        Style="{StaticResource PrimaryButton}"
                        HorizontalOptions="Start"
                        WidthRequest="130" />

                <Label Grid.Column="1"
                       Text="{Binding Cars.Count, StringFormat='Total: {0} cars'}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#333, Dark=#CCC}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />

                <Button Grid.Column="2"
                        Text="Next ▶"
                        Command="{Binding NextPageCommand}"
                        Style="{StaticResource PrimaryButton}"
                        HorizontalOptions="End"
                        WidthRequest="130" />
            </Grid>
        </Border>
    </Grid>
</ContentPage>