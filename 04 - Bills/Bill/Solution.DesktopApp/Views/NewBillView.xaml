<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModel="clr-namespace:Solution.DesktopApp.ViewModels"
             xmlns:billModels="clr-namespace:Solution.Services.Services.Bill.Models;assembly=Solution.Services"
             xmlns:billItemModels="clr-namespace:Solution.Services.Services.BillItem.Models;assembly=Solution.Services"
             xmlns:behaviors="clr-namespace:Solution.DesktopApp.Behaviors"
             x:DataType="viewModel:NewBillViewModel"
             x:Class="Solution.DesktopApp.Views.NewBillView"
             Title="Új Számla"
             BackgroundColor="#1e1e1e">

    <Grid ColumnDefinitions="400,*" ColumnSpacing="0">
        
        <!-- BAL OLDAL - Számla adatok és Tétel hozzáadása -->
        <ScrollView Grid.Column="0" BackgroundColor="#2b2b2b">
            <VerticalStackLayout Spacing="0">
                
                <!-- Számla adatok szekció -->
                <VerticalStackLayout Padding="20" Spacing="12" BackgroundColor="#2b2b2b">
                    <Label Text="Számla adatok" 
                           FontSize="16" 
                           TextColor="White"
                           Margin="0,0,0,10"/>
                    
                    <Label Text="Számlaszám" 
                           FontSize="12" 
                           TextColor="#999"/>
                    <Entry Text="{Binding CurrentBill.BillNumber}" 
                           Placeholder=""
                           TextColor="White"
                           PlaceholderColor="#666"
                           BackgroundColor="#1e1e1e"
                           HeightRequest="36"/>
                    
                    <Label Text="Számla kelte" 
                           FontSize="12" 
                           TextColor="#999"
                           Margin="0,8,0,0"/>
                    <DatePicker Date="{Binding CurrentBill.DateIssued}"
                                TextColor="White"
                                BackgroundColor="#1e1e1e"
                                HeightRequest="36"/>
                </VerticalStackLayout>
                
                <!-- Elválasztó vonal -->
                <BoxView HeightRequest="1" Color="#444" Margin="20,0"/>
                
                <!-- Tétel hozzáadása szekció -->
                <VerticalStackLayout Padding="20" Spacing="12" BackgroundColor="#2b2b2b">
                    <Label Text="Tétel hozzáadása" 
                           FontSize="16" 
                           TextColor="White"
                           Margin="0,0,0,10"/>
                    
                    <Label Text="Megnevezés" 
                           FontSize="12" 
                           TextColor="#999"/>
                    <Entry Text="{Binding CurrentBillItem.Name}" 
                           Placeholder=""
                           TextColor="White"
                           PlaceholderColor="#666"
                           BackgroundColor="#1e1e1e"
                           HeightRequest="36"/>
                    
                    <Label Text="Egységár" 
                           FontSize="12" 
                           TextColor="#999"
                           Margin="0,8,0,0"/>
                    <Entry Text="{Binding CurrentBillItem.UnitPrice}" 
                           Placeholder=""
                           Keyboard="Numeric"
                           TextColor="White"
                           PlaceholderColor="#666"
                           BackgroundColor="#1e1e1e"
                           HeightRequest="36">
                        <Entry.Behaviors>
                            <behaviors:EntryIntegerBehavior/>
                        </Entry.Behaviors>
                    </Entry>
                    
                    <Label Text="Mennyiség" 
                           FontSize="12" 
                           TextColor="#999"
                           Margin="0,8,0,0"/>
                    <Entry Text="{Binding CurrentBillItem.Quantity}" 
                           Placeholder=""
                           Keyboard="Numeric"
                           TextColor="White"
                           PlaceholderColor="#666"
                           BackgroundColor="#1e1e1e"
                           HeightRequest="36">
                        <Entry.Behaviors>
                            <behaviors:EntryIntegerBehavior/>
                        </Entry.Behaviors>
                    </Entry>
                    
                    <Button Text="hozzáad"
                            Command="{Binding AddOrUpdateBillItemCommand}"
                            BackgroundColor="#3a3a3a"
                            TextColor="White"
                            HeightRequest="36"
                            CornerRadius="4"
                            Margin="0,12,0,0"/>
                </VerticalStackLayout>
                
                <!-- Alsó gomb -->
                <VerticalStackLayout Padding="20,20,20,30" Spacing="0" BackgroundColor="#2b2b2b">
                    <Button Text="Számla adatainak mentése"
                            Command="{Binding SaveBillCommand}"
                            IsEnabled="{Binding CanSaveBill}"
                            BackgroundColor="#0d6efd"
                            TextColor="White"
                            HeightRequest="40"
                            CornerRadius="4"
                            FontSize="14"/>
                </VerticalStackLayout>
                
            </VerticalStackLayout>
        </ScrollView>

        <!-- JOBB OLDAL - Számla tételei lista -->
        <Grid Grid.Column="1" 
              BackgroundColor="#1e1e1e"
              RowDefinitions="Auto,*"
              Padding="0">
            
            <!-- Fejléc sáv -->
            <Grid Grid.Row="0" 
                  BackgroundColor="#3a3a3a" 
                  Padding="20,15"
                  ColumnDefinitions="*,Auto,Auto,Auto,Auto,Auto">
                <Label Grid.Column="0" 
                       Text="Számla tételei" 
                       FontSize="16" 
                       TextColor="White"
                       VerticalOptions="Center"/>
                
                <!-- Fejléc gombok -->
                <Label Grid.Column="1" 
                       Text="Megnevezés" 
                       FontSize="12" 
                       TextColor="#bbb"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       Margin="0,0,20,0"/>
                <Label Grid.Column="2" 
                       Text="Egységár" 
                       FontSize="12" 
                       TextColor="#bbb"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       Margin="0,0,20,0"/>
                <Label Grid.Column="3" 
                       Text="Mennyiség" 
                       FontSize="12" 
                       TextColor="#bbb"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       Margin="0,0,20,0"/>
                <Label Grid.Column="4" 
                       Text="Összesen" 
                       FontSize="12" 
                       TextColor="#bbb"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       Margin="0,0,20,0"/>
                <Label Grid.Column="5" 
                       Text="" 
                       FontSize="12" 
                       TextColor="#bbb"
                       VerticalOptions="Center"
                       WidthRequest="100"/>
            </Grid>
                
            <!-- Tételek listája -->
            <ScrollView Grid.Row="1" Padding="0">
                <CollectionView ItemsSource="{Binding BillItems}" Margin="0">
                    <CollectionView.EmptyView>
                        <VerticalStackLayout VerticalOptions="Center" 
                                           HorizontalOptions="Center" 
                                           Spacing="15"
                                           Margin="0,100">
                            <Label Text="Még nincs tétel hozzáadva" 
                                   TextColor="#888" 
                                   FontSize="14"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>
                    
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="billItemModels:BillItemModel">
                            <Grid Padding="20,10" 
                                  ColumnDefinitions="*,150,150,150,Auto"
                                  ColumnSpacing="20"
                                  BackgroundColor="Transparent">
                                
                                <!-- Megnevezés -->
                                <Label Grid.Column="0"
                                       Text="{Binding Name}" 
                                       FontSize="14" 
                                       TextColor="#e0e0e0"
                                       VerticalOptions="Center"/>
                                
                                <!-- Egységár -->
                                <Label Grid.Column="1"
                                       FontSize="14" 
                                       TextColor="#e0e0e0"
                                       VerticalOptions="Center">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding UnitPrice, StringFormat='{0:N0}'}" TextColor="#e0e0e0"/>
                                            <Span Text=" Ft" TextColor="#e0e0e0"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                                
                                <!-- Mennyiség -->
                                <Label Grid.Column="2"
                                       Text="{Binding Quantity}" 
                                       FontSize="14" 
                                       TextColor="#d0d0d0"
                                       VerticalOptions="Center"/>
                                
                                <!-- Összesen -->
                                <Label Grid.Column="3"
                                       FontSize="14" 
                                       TextColor="#e8e8e8"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding TotalPrice, StringFormat='{0:N0}'}" TextColor="#e8e8e8"/>
                                            <Span Text=" Ft" TextColor="#e8e8e8"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                                
                                <!-- Gombok -->
                                <HorizontalStackLayout Grid.Column="4" 
                                                     Spacing="8"
                                                     VerticalOptions="Center">
                                    <ImageButton Source="{AppThemeBinding Light=edit_dark.png, Dark=edit_light.png}"
                                                 Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:NewBillViewModel}}, Path=EditBillItemCommand}"
                                                 CommandParameter="{Binding .}"
                                                 BackgroundColor="Transparent"
                                                 WidthRequest="25"
                                                 HeightRequest="25"/>
                                    
                                    <ImageButton Source="{AppThemeBinding Light=delete_dark.png, Dark=delete_light.png}"
                                                 Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:NewBillViewModel}}, Path=DeleteBillItemCommand}"
                                                 CommandParameter="{Binding .}"
                                                 BackgroundColor="Transparent"
                                                 WidthRequest="25"
                                                 HeightRequest="25"/>
                                </HorizontalStackLayout>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </ScrollView>
        </Grid>

    </Grid>

</ContentPage>
