<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModel="clr-namespace:Solution.DesktopApp.ViewModels"
             xmlns:billModels="clr-namespace:Solution.Services.Services.Bill.Models;assembly=Solution.Services"
             xmlns:billItemModels="clr-namespace:Solution.Services.Services.BillItem.Models;assembly=Solution.Services"
             xmlns:behaviors="clr-namespace:Solution.DesktopApp.Behaviors"
             x:DataType="viewModel:NewBillViewModel"
             x:Class="Solution.DesktopApp.Views.NewBillView"
             Title="Ãšj SzÃ¡mla"
             BackgroundColor="#1e1e1e">

    <Grid ColumnDefinitions="400,*" ColumnSpacing="0">
        
        <!-- BAL OLDAL - SzÃ¡mla adatok Ã©s TÃ©tel hozzÃ¡adÃ¡sa -->
        <ScrollView Grid.Column="0" BackgroundColor="#2b2b2b">
            <VerticalStackLayout Spacing="0">
                
                <!-- SzÃ¡mla adatok szekciÃ³ -->
                <VerticalStackLayout Padding="20" Spacing="12" BackgroundColor="#2b2b2b">
                    <Label Text="SzÃ¡mla adatok" 
                           FontSize="16" 
                           TextColor="White"
                           Margin="0,0,0,10"/>
                    
                    <Label Text="SzÃ¡mlaszÃ¡m" 
                           FontSize="12" 
                           TextColor="#999"/>
                    <Entry Text="{Binding CurrentBill.BillNumber}" 
                           Placeholder=""
                           TextColor="White"
                           PlaceholderColor="#666"
                           BackgroundColor="#1e1e1e"
                           HeightRequest="36"/>
                    
                    <Label Text="SzÃ¡mla kelte" 
                           FontSize="12" 
                           TextColor="#999"
                           Margin="0,8,0,0"/>
                    <DatePicker Date="{Binding CurrentBill.DateIssued}"
                                TextColor="White"
                                BackgroundColor="#1e1e1e"
                                HeightRequest="36"/>
                </VerticalStackLayout>
                
                <!-- ElvÃ¡lasztÃ³ vonal -->
                <BoxView HeightRequest="1" Color="#444" Margin="20,0"/>
                
                <!-- TÃ©tel hozzÃ¡adÃ¡sa szekciÃ³ -->
                <VerticalStackLayout Padding="20" Spacing="12" BackgroundColor="#2b2b2b">
                    <Label Text="TÃ©tel hozzÃ¡adÃ¡sa" 
                           FontSize="16" 
                           TextColor="White"
                           Margin="0,0,0,10"/>
                    
                    <Label Text="MegnevezÃ©s" 
                           FontSize="12" 
                           TextColor="#999"/>
                    <Entry Text="{Binding CurrentBillItem.Name}" 
                           Placeholder=""
                           TextColor="White"
                           PlaceholderColor="#666"
                           BackgroundColor="#1e1e1e"
                           HeightRequest="36"/>
                    
                    <Label Text="EgysÃ©gÃ¡r" 
                           FontSize="12" 
                           TextColor="#999"
                           Margin="0,8,0,0"/>
                    <Entry Text="{Binding CurrentBillItem.UnitPrice}" 
                           Placeholder=""
                           Keyboard="Numeric"
                           TextColor="White"
                           PlaceholderColor="#666"
                           BackgroundColor="#1e1e1e"
                           HeightRequest="36">
                        <Entry.Behaviors>
                            <behaviors:EntryIntegerBehavior/>
                        </Entry.Behaviors>
                    </Entry>
                    
                    <Label Text="MennyisÃ©g" 
                           FontSize="12" 
                           TextColor="#999"
                           Margin="0,8,0,0"/>
                    <Entry Text="{Binding CurrentBillItem.Quantity}" 
                           Placeholder=""
                           Keyboard="Numeric"
                           TextColor="White"
                           PlaceholderColor="#666"
                           BackgroundColor="#1e1e1e"
                           HeightRequest="36">
                        <Entry.Behaviors>
                            <behaviors:EntryIntegerBehavior/>
                        </Entry.Behaviors>
                    </Entry>
                    
                    <Button Text="hozzÃ¡ad"
                            Command="{Binding AddOrUpdateBillItemCommand}"
                            BackgroundColor="#3a3a3a"
                            TextColor="White"
                            HeightRequest="36"
                            CornerRadius="4"
                            Margin="0,12,0,0"/>
                </VerticalStackLayout>
                
                <!-- AlsÃ³ gomb -->
                <VerticalStackLayout Padding="20,20,20,30" Spacing="0" BackgroundColor="#2b2b2b">
                    <Button Text="SzÃ¡mla adatainak mentÃ©se"
                            Command="{Binding SaveBillCommand}"
                            IsEnabled="{Binding CanSaveBill}"
                            BackgroundColor="#0d6efd"
                            TextColor="White"
                            HeightRequest="40"
                            CornerRadius="4"
                            FontSize="14"/>
                </VerticalStackLayout>
                
            </VerticalStackLayout>
        </ScrollView>

        <!-- JOBB OLDAL - SzÃ¡mla tÃ©telei lista -->
        <Grid Grid.Column="1" 
              BackgroundColor="#1e1e1e"
              RowDefinitions="Auto,*"
              Padding="0">
            
            <!-- FejlÃ©c sÃ¡v -->
            <Grid Grid.Row="0" 
                  BackgroundColor="#3a3a3a" 
                  Padding="20,15"
                  ColumnDefinitions="*,Auto,Auto,Auto,Auto,Auto">
                <Label Grid.Column="0" 
                       Text="SzÃ¡mla tÃ©telei" 
                       FontSize="16" 
                       TextColor="White"
                       VerticalOptions="Center"/>
                
                <!-- FejlÃ©c gombok -->
                <Label Grid.Column="1" 
                       Text="MegnevezÃ©s" 
                       FontSize="12" 
                       TextColor="#bbb"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       Margin="0,0,20,0"/>
                <Label Grid.Column="2" 
                       Text="EgysÃ©gÃ¡r" 
                       FontSize="12" 
                       TextColor="#bbb"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       Margin="0,0,20,0"/>
                <Label Grid.Column="3" 
                       Text="MennyisÃ©g" 
                       FontSize="12" 
                       TextColor="#bbb"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       Margin="0,0,20,0"/>
                <Label Grid.Column="4" 
                       Text="Ã–sszesen" 
                       FontSize="12" 
                       TextColor="#bbb"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       Margin="0,0,20,0"/>
                <Label Grid.Column="5" 
                       Text="" 
                       FontSize="12" 
                       TextColor="#bbb"
                       VerticalOptions="Center"
                       WidthRequest="100"/>
            </Grid>
                
            <!-- TÃ©telek listÃ¡ja -->
            <ScrollView Grid.Row="1" Padding="0">
                <CollectionView ItemsSource="{Binding BillItems}" Margin="0">
                    <CollectionView.EmptyView>
                        <VerticalStackLayout VerticalOptions="Center" 
                                           HorizontalOptions="Center" 
                                           Spacing="15"
                                           Margin="0,100">
                            <Label Text="MÃ©g nincs tÃ©tel hozzÃ¡adva" 
                                   TextColor="#888" 
                                   FontSize="14"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>
                    
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="billItemModels:BillItemModel">
                            <Grid Padding="20,10" 
                                  ColumnDefinitions="*,150,150,150,Auto"
                                  ColumnSpacing="20"
                                  BackgroundColor="Transparent">
                                
                                <!-- MegnevezÃ©s -->
                                <Label Grid.Column="0"
                                       Text="{Binding Name}" 
                                       FontSize="14" 
                                       TextColor="#e0e0e0"
                                       VerticalOptions="Center"/>
                                
                                <!-- EgysÃ©gÃ¡r -->
                                <Label Grid.Column="1"
                                       FontSize="14" 
                                       TextColor="#e0e0e0"
                                       VerticalOptions="Center">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding UnitPrice, StringFormat='{0:N0}'}" TextColor="#e0e0e0"/>
                                            <Span Text=" Ft" TextColor="#e0e0e0"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                                
                                <!-- MennyisÃ©g -->
                                <Label Grid.Column="2"
                                       Text="{Binding Quantity}" 
                                       FontSize="14" 
                                       TextColor="#d0d0d0"
                                       VerticalOptions="Center"/>
                                
                                <!-- Ã–sszesen -->
                                <Label Grid.Column="3"
                                       FontSize="14" 
                                       TextColor="#e8e8e8"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding TotalPrice, StringFormat='{0:N0}'}" TextColor="#e8e8e8"/>
                                            <Span Text=" Ft" TextColor="#e8e8e8"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                                
                                <!-- Gombok -->
                                <HorizontalStackLayout Grid.Column="4" 
                                                     Spacing="8"
                                                     VerticalOptions="Center">
                                    <Button Text="âœï¸" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:NewBillViewModel}}, Path=EditBillItemCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="Transparent"
                                            TextColor="#ccc"
                                            FontSize="16"
                                            WidthRequest="32"
                                            HeightRequest="32"
                                            Padding="0"
                                            CornerRadius="4"/>
                                    
                                    <Button Text="ðŸ—‘ï¸" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:NewBillViewModel}}, Path=DeleteBillItemCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="Transparent"
                                            TextColor="#ccc"
                                            FontSize="16"
                                            WidthRequest="32"
                                            HeightRequest="32"
                                            Padding="0"
                                            CornerRadius="4"/>
                                </HorizontalStackLayout>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </ScrollView>
        </Grid>

    </Grid>

</ContentPage>
