<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModel="clr-namespace:Solution.DesktopApp.ViewModels"
             xmlns:models="clr-namespace:Solution.Services.Services.Bill.Models;assembly=Solution.Services"
             x:DataType="viewModel:BillOverviewViewModel"
             x:Class="Solution.DesktopApp.Views.BillOverviewView"
             Title="Számlák Áttekintése"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#1E1E1E}">

    <Grid Padding="20" RowSpacing="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        
        <Label Grid.Row="0"
               Text="SZÁMLÁK"
               Style="{StaticResource PageTitle}"
               HorizontalOptions="Center"
               Margin="0,10,0,20" />

        
        <Border Grid.Row="1"
                BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1976D2}"
                Stroke="{AppThemeBinding Light=#1976D2, Dark=#0D47A1}"
                StrokeThickness="1">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200" />
                    <ColumnDefinition Width="150" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="80" />
                    <ColumnDefinition Width="80" />
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0" Text="Számlaszám" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="1" Text="Kelte" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="2" Text="Tételek száma" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="3" Text="Edit" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
                <Label Grid.Column="4" Text="Delete" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       FontSize="14"
                       HorizontalTextAlignment="Center" 
                       VerticalTextAlignment="Center" />
            </Grid>
        </Border>

        
        <Border Grid.Row="2"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#2D2D2D}"
                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                StrokeThickness="1">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8" />
            </Border.StrokeShape>
            
            <ScrollView>
                <CollectionView ItemsSource="{Binding DisplayedBills}">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:BillModel">
                            <Border BackgroundColor="Transparent"
                                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                                    Padding="0">
                                <Border Padding="0,10,0,10">
                                    <Grid Padding="10,0,10,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="200" />
                                            <ColumnDefinition Width="150" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                        </Grid.ColumnDefinitions>

                                        <Label Grid.Column="0"
                                               Text="{Binding BillNumber}" 
                                               HorizontalTextAlignment="Center" 
                                               VerticalTextAlignment="Center" />
                                        <Label Grid.Column="1"
                                               Text="{Binding DateIssued, StringFormat='{0:yyyy.MM.dd.}'}" 
                                               HorizontalTextAlignment="Center" 
                                               VerticalTextAlignment="Center" />
                                        <Label Grid.Column="2"
                                               Text="{Binding BillItems.Count, StringFormat='{0} tétel'}" 
                                               HorizontalTextAlignment="Center" 
                                               VerticalTextAlignment="Center" />
                                        <ImageButton Grid.Column="3"
                                                     Source="{AppThemeBinding Light=edit_dark.png, Dark=edit_light.png}"
                                                     Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:BillOverviewViewModel}}, Path=EditBillCommand}"
                                                     CommandParameter="{Binding .}"
                                                     HorizontalOptions="End" 
                                                     VerticalOptions="Center" 
                                                     BackgroundColor="Transparent"
                                                     WidthRequest="25" 
                                                     HeightRequest="25" />
                                        <ImageButton Grid.Column="4"
                                                     Source="{AppThemeBinding Light=delete_dark.png, Dark=delete_light.png}"
                                                     Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:BillOverviewViewModel}}, Path=DeleteBillCommand}"
                                                     CommandParameter="{Binding .}"
                                                     HorizontalOptions="End" 
                                                     VerticalOptions="Center" 
                                                     BackgroundColor="Transparent"
                                                     WidthRequest="25" 
                                                     HeightRequest="25" />
                                    </Grid>
                                </Border>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.EmptyView>
                        <StackLayout VerticalOptions="Center" 
                                   HorizontalOptions="Center" 
                                   Padding="40">
                            <Label Text="Nincs megjeleníthető számla"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            <Label Text="Hozz létre számlát a kezdéshez!"
                                   FontSize="14"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   TextColor="{AppThemeBinding Light=#999, Dark=#777}"
                                   Margin="0,10,0,0" />
                        </StackLayout>
                    </CollectionView.EmptyView>
                </CollectionView>
            </ScrollView>
        </Border>

       
        <Border Grid.Row="3"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#2D2D2D}"
                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                StrokeThickness="1"
                Padding="20">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8" />
            </Border.StrokeShape>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Text="◀ Előző"
                        Command="{Binding PreviousPageCommand}"
                        Style="{StaticResource PrimaryButton}"
                        HorizontalOptions="Start"
                        WidthRequest="130" />

                <Label Grid.Column="1"
                       Text="{Binding PageInfo}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#333, Dark=#CCC}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />

                <Button Grid.Column="2"
                        Text="Következő ▶"
                        Command="{Binding NextPageCommand}"
                        Style="{StaticResource PrimaryButton}"
                        HorizontalOptions="End"
                        WidthRequest="130" />
            </Grid>
        </Border>

    </Grid>

</ContentPage>
